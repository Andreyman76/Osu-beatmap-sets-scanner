deleteAllScriptData();

localization = {
	ru: {
		playCount: 'количество раз сыграно',
		fromArtist: 'от ',
		mappedBy: 'автор ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Скачать',
		withVideo: 'с видео',
		withoutVideo: 'без видео',
		beatmapSets: 'Наборы карт',
		downloadSets: 'Загрузить наборы карт',
		dirHint: 'Для загрузки списка отсутствующих наборов выберите папку с Osu. В противном случае будет загружен список всех Ваших наборов.'
	},
	en: {
		playCount: 'times played',
		fromArtist: 'by ',
		mappedBy: 'mapped by ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Download',
		withVideo: 'with Video',
		withoutVideo: 'without Video',
		beatmapSets: 'Beatmap sets',
		downloadSets: 'Download beatmap sets',
		dirHint: 'To download a list of missing beatmap sets, select the Osu folder. Otherwise, a list of all your beatmap sets will be loaded.'
	},
	be: {
		playCount: 'згуляна раз',
		fromArtist: 'ад ',
		mappedBy: 'створана ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Спампаваць',
		withVideo: 'з відэа',
		withoutVideo: 'без відэа',
		beatmapSets: 'Наборы бітмэпаў',
		downloadSets: 'Спампаваць наборы бітмэпаў',
		dirHint: 'Каб загрузіць спіс адсутных набораў бітмэпаў, абярыце тэчку Osu. У адваротным выпадку будзе загружаны спіс усіх вашых набораў бітмэпаў.'
	},
	cs: {
		playCount: 'odehraný čas',
		fromArtist: 'autora ',
		mappedBy: 'beatmapu vytvořil ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Stáhnout',
		withVideo: 's Videem',
		withoutVideo: 'bez Videa',
		beatmapSets: 'Beatmap sady',
		downloadSets: 'Stáhněte si sady beatmap',
		dirHint: 'Chcete-li stáhnout seznam chybějících sad beatmap, vyberte složku Osu. Jinak se načte seznam všech vašich sad beatmap.'
	},
	de: {
		playCount: 'mal gespielt',
		fromArtist: 'von ',
		mappedBy: 'erstellt von ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Herunterladen',
		withVideo: 'mit Video',
		withoutVideo: 'ohne Video',
		beatmapSets: 'Beatmap-Sets',
		downloadSets: 'Beatmap-Sets herunterladen',
		dirHint: 'Um eine Liste fehlender Beatmap-Sets herunterzuladen, wählen Sie den Ordner Osu. Andernfalls wird eine Liste aller Ihrer Beatmap-Sets geladen.'
	},
	es: {
		playCount: 'veces jugadas',
		fromArtist: 'por ',
		mappedBy: 'mapeado por ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Descargar',
		withVideo: 'con vídeo',
		withoutVideo: 'sin vídeo',
		beatmapSets: 'Conjuntos de mapas de ritmos',
		downloadSets: 'Descargar conjuntos de mapas de ritmos',
		dirHint: 'Para descargar una lista de conjuntos de mapas de ritmos que faltan, seleccione la carpeta Osu. De lo contrario, se cargará una lista de todos sus conjuntos de mapas de ritmos.'
	},
	fr: {
		playCount: 'nombre de fois jouée',
		fromArtist: 'par ',
		mappedBy: 'mappée par ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Télécharger',
		withVideo: 'avec Vidéo',
		withoutVideo: 'sans Vidéo',
		beatmapSets: 'Ensembles de beatmaps',
		downloadSets: 'Télécharger des ensembles de beatmaps',
		dirHint: 'Pour télécharger une liste des ensembles de beatmaps manquants, sélectionnez le dossier Osu. Sinon, une liste de tous vos ensembles de beatmaps sera chargée.'
	},
	id: {
		playCount: 'jumlah dimainkan',
		fromArtist: 'oleh ',
		mappedBy: 'dibuat oleh ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Unduh',
		withVideo: 'dengan Video',
		withoutVideo: 'tanpa Video',
		beatmapSets: 'Kumpulan peta beat',
		downloadSets: 'Unduh set beatmap',
		dirHint: 'Untuk mengunduh daftar set beatmap yang hilang, pilih folder Osu. Jika tidak, daftar semua set beatmap Anda akan dimuat.'
	},
	ja: {
		playCount: 'プレイ回数',
		fromArtist: 'by ',
		mappedBy: '作者 ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'ダウンロード',
		withVideo: '動画あり',
		withoutVideo: '動画なし',
		beatmapSets: 'ビートマップ セット',
		downloadSets: 'ビートマップ セットをダウンロードする',
		dirHint: '不足しているビートマップ セットのリストをダウンロードするには、Osu フォルダーを選択します。 それ以外の場合は、すべてのビートマップ セットのリストが読み込まれます。'
	},
	nl: {
		playCount: 'keer gespeeld',
		fromArtist: 'door ',
		mappedBy: 'gemapped door ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Downloaden',
		withVideo: 'met Video',
		withoutVideo: 'zonder Video',
		beatmapSets: 'Beatmap-sets',
		downloadSets: 'Beatmap-sets downloaden',
		dirHint: 'Selecteer de Osu-map om een lijst met ontbrekende beatmapsets te downloaden. Anders wordt een lijst met al je beatmapsets geladen.'
	},
	pl: {
		playCount: 'liczba zagrań',
		fromArtist: 'autorstwa ',
		mappedBy: 'autorstwa ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Pobierz',
		withVideo: 'z wideo',
		withoutVideo: 'bez wideo',
		beatmapSets: 'Zestawy beatmap',
		downloadSets: 'Pobierz zestawy beatmap',
		dirHint: 'Aby pobrać listę brakujących zestawów beatmap, wybierz folder Osu. W przeciwnym razie zostanie załadowana lista wszystkich zestawów beatmap.'
	},
	'pt-BR': {
		playCount: 'vezes jogadas',
		fromArtist: 'por ',
		mappedBy: 'mapeado por ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Baixar',
		withVideo: 'com Vídeo',
		withoutVideo: 'sem Vídeo',
		beatmapSets: 'Conjuntos de beatmaps',
		downloadSets: 'Baixar conjuntos de beatmaps',
		dirHint: 'Para baixar uma lista de conjuntos de beatmaps ausentes, selecione a pasta Osu. Caso contrário, uma lista de todos os seus conjuntos de beatmaps será carregada.'
	},
	sv: {
		playCount: 'gånger spelade',
		fromArtist: 'av ',
		mappedBy: 'skapad av ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Ladda ner',
		withVideo: 'med video',
		withoutVideo: 'utan video',
		beatmapSets: 'Beatmap set',
		downloadSets: 'Ladda ner beatmap set',
		dirHint: 'För att ladda ner en lista över saknade beatmap-uppsättningar, välj mappen Osu. Annars kommer en lista över alla dina beatmap-uppsättningar att laddas.'
	},
	tr: {
		playCount: 'oynama sayısı',
		fromArtist: '',
		mappedBy: '',
		fromArtistRight: ' tarafından',
		mappedByRight: ' tarafından yapıldı',
		download: 'İndir',
		withVideo: 'Video ile',
		withoutVideo: 'Video olmadan',
		beatmapSets: 'Beatmap setleri',
		downloadSets: 'Beatmap setlerini indir',
		dirHint: 'Eksik beatmap setlerinin listesini indirmek için Osu klasörünü seçin. Aksi takdirde, tüm beatmap setlerinizin bir listesi yüklenecektir.'
	},
	vi: {
		playCount: 'số lần chơi',
		fromArtist: 'bởi ',
		mappedBy: 'được tạo bởi ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Tải Xuống',
		withVideo: 'cùng Video',
		withoutVideo: 'không Video',
		beatmapSets: 'bộ beatmap',
		downloadSets: 'Tải xuống bộ beatmap',
		dirHint: 'Để tải xuống danh sách các bộ beatmap còn thiếu, hãy chọn thư mục Osu. Nếu không, danh sách tất cả các bộ beatmap của bạn sẽ được tải.'
	},
	'zh-TW': {
		playCount: '遊玩次數',
		fromArtist: '作者: ',
		mappedBy: '由 ',
		fromArtistRight: '',
		mappedByRight: ' 製作',
		download: '下載',
		withVideo: '含影像',
		withoutVideo: '不含影像',
		beatmapSets: '譜面集',
		downloadSets: '下載譜面集',
		dirHint: '要下載丟失的譜面集列表，請選擇 Osu 文件夾。 否則，將加載所有譜面集的列表。'
	},
	ar: {
		playCount: 'مرة لُعِبت',
		fromArtist: 'بواسطة ',
		mappedBy: 'نشأت بواسطة  ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'تنزيل',
		withVideo: 'مع الفيديو',
		withoutVideo: 'دون الفيديو',
		beatmapSets: 'مجموعات Beatmap',
		downloadSets: 'تحميل مجموعات beatmap',
		dirHint: 'لتنزيل قائمة بمجموعات خرائط الضرب المفقودة ، حدد مجلد Osu. خلاف ذلك ، سيتم تحميل قائمة بجميع مجموعات الخرائط الخاصة بك.'
	},
	bg: {
		playCount: 'пъти изигран',
		fromArtist: '- ',
		mappedBy: 'създаден от ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Изтегляне',
		withVideo: 'с видео',
		withoutVideo: 'без видео',
		beatmapSets: 'Комплекти beatmap',
		downloadSets: 'Изтеглете комплекти beatmap',
		dirHint: 'За да изтеглите списък с липсващи комплекти beatmap, изберете папката Osu. В противен случай ще бъде зареден списък с всичките ви набори от beatmap.'
	},
	da: {
		playCount: 'gange spillet',
		fromArtist: 'af ',
		mappedBy: 'mappet af ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Download',
		withVideo: 'med video',
		withoutVideo: 'uden video',
		beatmapSets: 'Beatmap sæt',
		downloadSets: 'Hent beatmap sæt',
		dirHint: 'For at downloade en liste over manglende beatmap-sæt skal du vælge mappen Osu. Ellers vil en liste over alle dine beatmap-sæt blive indlæst.'
	},
	el: {
		playCount: 'φορές που παίχτηκε',
		fromArtist: 'από ',
		mappedBy: 'δημιουργήθηκε από ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Λήψη',
		withVideo: 'με Βίντεο',
		withoutVideo: 'χωρίς Βίντεο',
		beatmapSets: 'Σετ Beatmap',
		downloadSets: 'Κατεβάστε σετ beatmap',
		dirHint: 'Για λήψη μιας λίστας με σύνολα beatmap που λείπουν, επιλέξτε το φάκελο Osu. Διαφορετικά, θα φορτωθεί μια λίστα με όλα τα σετ beatmap.'
	},
	fi: {
		playCount: 'pelikertoja: ',
		fromArtist: 'artistilta ',
		mappedBy: 'luonut: ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Lataa',
		withVideo: 'videon kanssa',
		withoutVideo: 'ilman videota',
		beatmapSets: 'Beatmap-sarjat',
		downloadSets: 'Lataa beatmap-sarjat',
		dirHint: 'Jos haluat ladata luettelon puuttuvista beatmap-sarjoista, valitse Osu-kansio. Muussa tapauksessa ladataan luettelo kaikista beatmap-sarjoistasi.'
	},
	hu: {
		playCount: 'alkalommal lejátszva',
		fromArtist: '',
		mappedBy: 'mappolva  ',
		fromArtistRight: ' által',
		mappedByRight: ' által',
		download: 'Letöltés',
		withVideo: 'Videóval',
		withoutVideo: 'Videó nélkül',
		beatmapSets: 'Beatmap készletek',
		downloadSets: 'Beatmap készletek letöltése',
		dirHint: 'A hiányzó ütemtérkép-készletek listájának letöltéséhez válassza ki az Osu mappát. Ellenkező esetben az összes beatmap készlet listája betöltődik.'
	},
	it: {
		playCount: 'volte giocata',
		fromArtist: 'di ',
		mappedBy: 'mappata da ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Scarica',
		withVideo: 'con Video',
		withoutVideo: 'senza Video',
		beatmapSets: 'Set di beatmap',
		downloadSets: 'Scarica set di beatmap',
		dirHint: 'Per scaricare un elenco di set di beatmap mancanti, seleziona la cartella Osu. Altrimenti, verrà caricato un elenco di tutti i tuoi set di beatmap.'
	},
		ko: {
		playCount: '플레이 횟수',
		fromArtist: 'by ',
		mappedBy: '',
		fromArtistRight: '',
		mappedByRight: ' 님의 맵',
		download: '다운로드',
		withVideo: '영상 포함',
		withoutVideo: '영상 미포함',
		beatmapSets: '비트맵 세트',
		downloadSets: '비트맵 세트 다운로드',
		dirHint: '누락된 비트맵 세트 목록을 다운로드하려면 Osu 폴더를 선택하세요. 그렇지 않으면 모든 비트맵 세트 목록이 로드됩니다.'
	},
	no: {
		playCount: 'antall forsøk',
		fromArtist: 'av ',
		mappedBy: 'mappet av ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Last ned',
		withVideo: 'med Video',
		withoutVideo: 'uten Video',
		beatmapSets: 'Beatmap-sett',
		downloadSets: 'Last ned beatmap-sett',
		dirHint: 'For å laste ned en liste over manglende beatmap-sett, velg Osu-mappen. Ellers vil en liste over alle dine beatmap-sett lastes inn.'
	},
	pt: {
		playCount: 'vezes jogados',
		fromArtist: 'por ',
		mappedBy: 'mapeado por ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Descarregar',
		withVideo: 'com vídeo',
		withoutVideo: 'sem vídeo',
		beatmapSets: 'Conjuntos de beatmaps',
		downloadSets: 'Baixar conjuntos de beatmaps',
		dirHint: 'Para baixar uma lista de conjuntos de beatmaps ausentes, selecione a pasta Osu. Caso contrário, uma lista de todos os seus conjuntos de beatmaps será carregada.'
	},
	ro: {
		playCount: 'jucat de',
		fromArtist: 'de  ',
		mappedBy: 'creat de ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Descarcă',
		withVideo: 'cu video',
		withoutVideo: 'fără video',
		beatmapSets: 'Seturi de Beatmap',
		downloadSets: 'Descărcați seturi de beatmap',
		dirHint: 'Pentru a descărca o listă de seturi de beatmap lipsă, selectați folderul Osu. În caz contrar, va fi încărcată o listă cu toate seturile de beatmap.'
	},
	sk: {
		playCount: 'odohraný čas',
		fromArtist: 'od ',
		mappedBy: 'beatmapu vytvoril ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Stiahnúť',
		withVideo: 's Videom',
		withoutVideo: 'bez Videa',
		beatmapSets: 'Beatmap sady',
		downloadSets: 'Stiahnúť si sady beatmap',
		dirHint: 'Ak chcete stiahnuť zoznam chýbajúcich sád beatmap, vyberte priečinok Osu. V opačnom prípade sa načíta zoznam všetkých vašich sád beatmap.'
	},
	th: {
		playCount: 'จำนวนครั้งที่เล่น',
		fromArtist: 'โดย ',
		mappedBy: 'แมพโดย ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'ดาวน์โหลด',
		withVideo: 'พร้อมวิดิโอ',
		withoutVideo: 'ไม่มีวิดิโอ',
		beatmapSets: 'ชุดบีทแมป',
		downloadSets: 'ดาวน์โหลดชุดบีทแมป',
		dirHint: 'หากต้องการดาวน์โหลดรายการชุดบีทแมปที่ขาดหายไป ให้เลือกโฟลเดอร์ Osu มิฉะนั้น รายการชุดบีทแมปทั้งหมดของคุณจะถูกโหลด'
	},
		uk: {
		playCount: 'разів зіграно',
		fromArtist: 'від ',
		mappedBy: 'створена ',
		fromArtistRight: '',
		mappedByRight: '',
		download: 'Завантажити',
		withVideo: 'з відео',
		withoutVideo: 'без відео',
		beatmapSets: 'Набори бітмап',
		downloadSets: 'Завантажте набори бітмап',
		dirHint: 'Щоб завантажити список відсутніх наборів бітмап, виберіть папку Osu. В іншому випадку буде завантажено список усіх ваших наборів бітмап.'
	},
		zh: {
		playCount: '游玩次数',
		fromArtist: 'by ',
		mappedBy: '谱师： ',
		fromArtistRight: '',
		mappedByRight: '',
		download: '下载',
		withVideo: '包含视频',
		withoutVideo: '不包含视频',
		beatmapSets: '谱面集',
		downloadSets: '下载谱面集',
		dirHint: '要下载丢失的谱面集列表，请选择 Osu 文件夹。 否则，将加载所有谱面集的列表。'
	}
};

cards = [];
downloadedSongs = [];
lang = document.getElementsByTagName("html")[0].getAttribute("lang");
currentLocale = localization.hasOwnProperty(lang) ? localization[lang] : localization.en;

avatars = document.getElementsByClassName('avatar avatar--nav2 js-current-user-avatar js-click-menu js-user-login--menu js-user-header');
timer = setInterval(inject, 500);
startLocation = window.location.pathname;

function deleteAllScriptData(){
	try{
		clearInterval(timer);
		delete localization;
		delete cards;
		delete downloadedSongs;
		delete timer;
		delete startLocation;
		delete avatars;
		delete lang;
		delete currentLocale;
	}
	catch(error) {
	}
}

function Card(card) {
	this.id = card['beatmap']['beatmapset_id'];
	this.cover = card['beatmapset']['covers']['cover'];
	this.list2x = card['beatmapset']['covers']['list@2x'];
	this.mapId = card['beatmap_id'];
	this.count = card['count'];
	this.title = card['beatmapset']['title'];
	this.artist = card['beatmapset']['artist'];
	this.creator = card['beatmapset']['creator'];
	this.userId = card['beatmapset']['user_id'];
	this.video = card['beatmapset']['video'];
	this.audio = card['beatmapset']['preview_url'];
}

function generateDownloadButton(id, oneButton, video) {
	const videoCaption = video ? currentLocale.withVideo : currentLocale.withoutVideo;
	const bottom = oneButton ? '' : `<span class="btn-osu-big__text-bottom">${videoCaption}</span>`;
	const noVideo = oneButton ? '' : '?noVideo=1';
	const href = `https://osu.ppy.sh/beatmapsets/${id}/download${video ? '' : noVideo}`;
	const htmlText = `
	<a class="btn-osu-big btn-osu-big--beatmapset-header download-button" href="${href}" data-turbolinks="false">
		<span class="btn-osu-big__content">
			<span class="btn-osu-big__left">
				<span class="btn-osu-big__text-top">${currentLocale.download}
				</span>
				${bottom}
			</span>
			<span class="btn-osu-big__icon">
				<span class="fa fa-fw">
					<span class="fas fa-download">
					</span>
				</span>
			</span>
		</span>
	</a>`;
	
	return htmlText;
}

function generateCard(card) {
	const href = `https://osu.ppy.sh/beatmapsets/${card.id}#osu/${card.mapId}`;
	const downloadButtons = card.video ? generateDownloadButton(card.id, false, true) + generateDownloadButton(card.id, false, false) : generateDownloadButton(card.id, true, false);
	
	const playButton = `
	<button class="beatmapset-stats__row beatmapset-stats__row--preview js-audio--play js-audio--player" data-audio-url="${card.audio}" type="button" data-audio-autoplay="0" data-audio-has-duration="1" data-audio-state="paused" data-audio-time-format="minute_minimal" style="--duration:&quot;0:10&quot;; --current-time:&quot;0:00&quot;; --progress:0;" data-audio-over50="0">
		<span class="play-button">
		</span>
		<div class="beatmapset-stats__elapsed-bar">
		</div>
	</button>`;
	
	const htmlText = `
	<div class="beatmap-playcount">
		<div class="beatmap-playcount__cover">
			<div class="beatmapset-cover beatmapset-cover--full" style="--bg:url(&quot;${card.cover}&quot;); --bg-2x:url(&quot;${card.list2x}&quot;);">
			${playButton}
			</div>
			<div class="beatmap-playcount__cover-count">
				<div class="beatmap-playcount__count" title="${currentLocale.playCount}">
					<span class="beatmap-playcount__count-icon">
						<span class="fas fa-play">
						</span>
					</span>${card.count}
				</div>
			</div>
		</div>
		<div class="beatmap-playcount__detail">
			<div class="beatmap-playcount__info">
				<div class="beatmap-playcount__info-row u-ellipsis-overflow" style="max-width: 60%; overflow: hidden;">
					<a class="beatmap-playcount__title" href="${href}">${card.title}
						<span class="beatmap-playcount__title-artist">${currentLocale.fromArtist}${card.artist}${currentLocale.fromArtistRight}
						</span>
					</a>
				</div>
				<div class="beatmap-playcount__info-row u-ellipsis-overflow">
					<span class="beatmap-playcount__artist">${currentLocale.fromArtist}<strong>${card.artist}</strong>${currentLocale.fromArtistRight}
					</span>
					<span class="beatmap-playcount__mapper">${currentLocale.mappedBy}<a class="js-usercard beatmap-playcount__mapper-link" data-user-id="${card.userId}" href="https://osu.ppy.sh/users/${card.userId}">${card.creator}</a>${currentLocale.mappedByRight}
					</span>
				</div>
			</div>
			<div style="position: absolute;left: 60%;">
				${downloadButtons}
			</div>
			<div class="beatmap-playcount__detail-count">
				<div class="beatmap-playcount__count" title="${currentLocale.playCount}">
					<span class="beatmap-playcount__count-icon">
						<span class="fas fa-play">
						</span>
					</span>${card.count}
				</div>
			</div>
		</div>
	</div>`;
	
	return htmlText;
}

function getCards(uid, offset, limit) {
	const url = `https://osu.ppy.sh/users/${uid}/beatmapsets/most_played?limit=${limit}&offset=${offset}`;
	const xmlHttp = new XMLHttpRequest();
	xmlHttp.open( "GET", url, false );
	xmlHttp.send( null );
	const list = JSON.parse(xmlHttp.responseText);
	
	if(xmlHttp.responseText === '[]') {
		return false;
	}
	
	for(const i of list) {
		const card = new Card(i);
		
		if(downloadedSongs.includes(card.id)) {
			continue;
		}
		
		const index = cards.findIndex(x => x.id == card.id);
		
		if(index < 0) {
			cards.push(card);
		}
		else {
			cards[index].count += card.count;
		}
	}
	
	return true;
}

function sortCards(a, b) {
	const difference =  b.count - a.count;
	
	if(difference != 0) {
		return difference;
	}
	
	return a.title.localeCompare(b.title);
}

function inject() {
	if(window.location.pathname != startLocation) {
		deleteAllScriptData();
		return;
	}

	if(avatars.length != 0) {
		if(avatars[0].href.split('/')[4] != document.location.pathname.split('/')[2]) {
			deleteAllScriptData();
			return;
		}
	}

	if(document.getElementById('cards-container') != null){
		return;
	}

	const headers = document.getElementsByClassName('title title--page-extra-small');

	if(!headers) {
		return;
	}

	for(const header of headers) {
		if(header.nextElementSibling.className == 'beatmap-playcount') {
			clearInterval(timer);
	
			const title = document.createElement('h3');
			title.classList.add('title');
			title.classList.add('title--page-extra-small');
			title.textContent = currentLocale.beatmapSets;
			header.insertAdjacentElement('beforebegin', title);
			
			const dirPicker = document.createElement('button');
			dirPicker.classList.add('dir-picker');
			dirPicker.classList.add('show-more-link');
			dirPicker.classList.add('show-more-link--profile-page');	
			dirPicker.setAttribute('title', currentLocale.dirHint);
			
			dirPicker.innerHTML = `
				<span class="show-more-link__spinner">
					<div class="la-ball-clip-rotate">
					</div>
				</span>
				<span class="show-more-link__label">
					<span class="show-more-link__label-icon show-more-link__label-icon--left">
						<span class="fas fa-angle-down">
						</span>
					</span>
					<span class="show-more-link__label-text">${currentLocale.downloadSets}
					</span>
					<span class="show-more-link__label-icon show-more-link__label-icon--right">
						<span class="fas fa-angle-down">
						</span>
					</span>
				</span>`;
				
			title.insertAdjacentElement('afterend', dirPicker);
			
			const container = document.createElement('div');
			container.id = 'cards-container';
			dirPicker.insertAdjacentElement('afterend', container);	
			
			const spinner = document.createElement('p');
			spinner.style.textAlign = 'center';
			spinner.insertAdjacentHTML('beforeend', '<img src="https://osu.ppy.sh/assets/images/preloader.14d740b6.gif">');
			
			dirPicker.addEventListener('click', () => {
				dirPicker.remove();
				container.insertAdjacentElement('afterbegin', spinner);
				drawCards(title, container, spinner);
			});
			
			container.addEventListener("click", function (event) { 
				if (event.target.closest('.download-button')) {
					event.target.closest('.beatmap-playcount').style.opacity = 0.25;
				}
			});
			break;
		}
	}
}

async function drawCards(title, container, spinner) {
	try {
		const dirHandle = await window.showDirectoryPicker();
		
		for await (const entry of dirHandle.values()) {
			if(entry.name == 'Songs') {
				for await (const key of entry.keys()) {
					downloadedSongs.push(parseInt(key.slice(0, key.indexOf(' '))));
				}
				break;
			}
		}
	}
	catch(error) {
		cards = [];
	}
	
	const uid = document.location.pathname.split('/')[2];
	let offset = 0;
	const limit = 100;
	
	while(getCards(uid, offset, limit)) {
		offset += 100;
	}
	
	getCards(uid, offset, limit)
	cards.sort(sortCards);
	spinner.remove();
	
	for(const card of cards) {
		container.insertAdjacentHTML('beforeend', generateCard(card));
	}
	
	const count = cards.length;
	
	title.insertAdjacentHTML('beforeend', `<span class="title__count">${count}</span>`);
	deleteAllScriptData();
}